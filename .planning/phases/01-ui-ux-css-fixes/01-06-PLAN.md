---
phase: 01-ui-ux-css-fixes
plan: 06
type: execute
wave: 2
depends_on: ["05", "08"]
files_modified:
  - frontend/src/components/CreateUserModal.tsx
  - frontend/src/components/EditUserModal.tsx
  - frontend/src/components/application/StatusHistoryModal.tsx
  - frontend/src/components/ImportModal.tsx
  - frontend/src/components/MediaPlayer.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Modal content areas use bg-bg2 (3rd layer) instead of bg-bg4"
    - "Modals follow the 5-layer reset rule: reset to bg-bg2 then layer from there"
  artifacts:
    - path: "frontend/src/components/CreateUserModal.tsx"
      provides: "Modal with bg-bg2 background"
      min_lines: 1
    - path: "frontend/src/components/EditUserModal.tsx"
      provides: "Modal with bg-bg2 background"
      min_lines: 1
    - path: "frontend/src/components/application/StatusHistoryModal.tsx"
      provides: "Modal with bg-bg2 background"
      min_lines: 1
    - path: "frontend/src/components/ImportModal.tsx"
      provides: "Modal with bg-bg2 background"
      min_lines: 1
    - path: "frontend/src/components/MediaPlayer.tsx"
      provides: "Modal with bg-bg2 background"
      min_lines: 1
  key_links:
    - from: "Modal component structure"
      to: "5-layer reset rule"
      via: "bg-bg2 instead of bg-bg4"
      pattern: "bg-bg2.*modal"
---

<objective>
Fix modal backgrounds to use bg-bg2 instead of bg-bg4 (5-layer reset rule)

Purpose: User reported modals should start from bg-bg2 (3c3836 color) and follow the 5-layer strategy from there, not continue as another layer. This implements the "modal reset rule" where modals reset to bg-bg2 then follow 5-layer strategy.

Output: All modal content containers use bg-bg2 background (not bg-bg4)
</objective>

<execution_context>
@/home/vscode/.claude/get-shit-done/workflows/execute-plan.md
@/home/vscode/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-ui-ux-css-fixes/01-UAT.md
@.planning/phases/01-ui-ux-css-fixes/01-04-SUMMARY.md
@frontend/DESIGN_GUIDELINES.md

# Gap Context
Gap 4 from UAT: "Modals Use Wrong Background Layer (Should Reset to bg-bg2)"
- User reported: "popups like the admin create user are the wrong color (they should not count as the fifth or forth layer, but rather the bg should be the 3c bg color and then it should go from there"
- 5-color Gruvbox: bg0 (#282828) -> bg1 (#3c3836) -> bg2 (#504945) -> bg3 (#665c54) -> bg4 (#7c6f64)
- Modal reset rule: Modals should reset to bg-bg2 (3rd layer) then follow 5-layer strategy

Gap 10 from UAT: "Modals Should Follow 5-Layer Reset Rule"
- User clarification: "modal should start from the 3c3836 color and then follow the 5 layers strategy from there (also maybe add the context to the frontend design document that the 5 layer rule exists and that if 5 layers are exceeded it just starts over again from the base 282828 layer)"

# Dependency Note
This is Wave 2 - depends on plans 01-05 (input borders) and 01-08 (Admin/table fixes). Both must complete first as this plan modifies files that were changed in those plans (CreateUserModal, EditUserModal, ImportModal).
</context>

<tasks>

<task type="auto">
  <name>Task 1: Change modal backgrounds from bg-bg4 to bg-bg2</name>
  <files>frontend/src/components/CreateUserModal.tsx, frontend/src/components/EditUserModal.tsx, frontend/src/components/application/StatusHistoryModal.tsx, frontend/src/components/ImportModal.tsx, frontend/src/components/MediaPlayer.tsx</files>
  <action>
    Find and replace all instances of modal content containers using "bg-bg4" with "bg-bg2".

    For each modal file:
    1. CreateUserModal.tsx - Line 62: Change bg-bg4 to bg-bg2
    2. EditUserModal.tsx - Line 90: Change bg-bg4 to bg-bg2
    3. StatusHistoryModal.tsx - Line 43: Change bg-bg4 to bg-bg2
    4. ImportModal.tsx - Line 118: Change bg-bg4 to bg-bg2
    5. MediaPlayer.tsx - Line 88: Change bg-bg4 to bg-bg2

    Pattern: Find <div className="... bg-bg4 ..." that represents the modal content container (not the overlay) and change to bg-bg2.

    Do NOT change:
    - The overlay/backdrop (uses bg-bg0/80)
    - Any nested elements that legitimately use bg-bg4

    The modal content container is typically the div with onClick={(e) => e.stopPropagation()} that contains the modal header and content.
  </action>
  <verify>grep -rn "bg-bg4" frontend/src/components/CreateUserModal.tsx frontend/src/components/EditUserModal.tsx frontend/src/components/application/StatusHistoryModal.tsx frontend/src/components/ImportModal.tsx frontend/src/components/MediaPlayer.tsx returns no modal content containers with bg-bg4</verify>
  <done>All 5 modal components use bg-bg2 for modal content container instead of bg-bg4</done>
</task>

<task type="auto">
  <name>Task 2: Update modal input backgrounds for bg-bg2 context</name>
  <files>frontend/src/components/CreateUserModal.tsx, frontend/src/components/EditUserModal.tsx, frontend/src/components/ImportModal.tsx</files>
  <action>
    After changing modal backgrounds to bg-bg2, inputs inside modals should use bg-bg3 (next color darker) instead of bg-bg2 for proper visibility.

    Update input backgrounds in modals:
    - CreateUserModal.tsx lines 89, 103: Change bg-bg2 to bg-bg3 for email/password inputs
    - EditUserModal.tsx line 155: Change bg-bg2 to bg-bg3 for password input
    - ImportModal.tsx line 205: Change bg-bg2 to bg-bg3 for file input

    This follows the "next color darker" rule: bg-bg2 container -> bg-bg3 input
  </action>
  <verify>grep -n "bg-bg2" frontend/src/components/CreateUserModal.tsx frontend/src/components/EditUserModal.tsx frontend/src/components/ImportModal.tsx | grep -i "input\|select" returns no inputs with bg-bg2 inside modal content</verify>
  <done>Inputs inside modals use bg-bg3 (appropriate for bg-bg2 modal background)</done>
</task>

</tasks>

<verification>
1. Run: grep -rn "bg-bg4" frontend/src/components/*.tsx frontend/src/components/**/*.tsx | grep -v "overlay\|backdrop" to verify no modal content containers still use bg-bg4

2. Run: npm run build to ensure no TypeScript errors

3. Manual check: Open any modal (Create User, Edit User, Import, Status History, Media Player) and verify background is bg-bg2 (#504945), not bg-bg4 (#7c6f64)
</verification>

<success_criteria>
1. All modal content containers use bg-bg2 background
2. Inputs inside modals use bg-bg3 background (next darker from bg-bg2)
3. Build passes without errors
4. Modal backgrounds are visibly darker than before (proper reset rule applied)
</success_criteria>

<output>
After completion, create `.planning/phases/01-ui-ux-css-fixes/01-06-SUMMARY.md`
</output>
